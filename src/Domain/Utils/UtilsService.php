<?php

namespace Domain\Utils;

use GeoIp2\Database\Reader;
use GeoIp2\Exception\AddressNotFoundException;

class UtilsService {

    public static $countries = array(
        'AU' => 'Австралия',
        'AT' => 'Австрия',
        'AZ' => 'Азербайджан',
        'AX' => 'Аландские острова',
        'AL' => 'Албания',
        'DZ' => 'Алжир',
        'VI' => 'Виргинские острова, США',
        'AS' => 'Американское Самоа',
        'AI' => 'Ангилья',
        'AO' => 'Ангола',
        'AD' => 'Андорра',
        'AQ' => 'Антарктида',
        'AG' => 'Антигуа и Барбуда',
        'AR' => 'Аргентина',
        'AM' => 'Армения',
        'AW' => 'Аруба',
        'AF' => 'Афганистан',
        'BS' => 'Багамские острова',
        'BD' => 'Бангладеш',
        'BB' => 'Барбадос',
        'BH' => 'Бахрейн',
        'BZ' => 'Белиз',
        'BY' => 'Белоруссия',
        'BE' => 'Бельгия',
        'BJ' => 'Бенин',
        'BM' => 'Бермуды',
        'BG' => 'Болгария',
        'BO' => 'Боливия',
        'BQ' => 'Бонэйр, Синт-Эстатиус и Саба',
        'BA' => 'Босния и Герцеговина',
        'BW' => 'Ботсвана',
        'BR' => 'Бразилия',
        'IO' => 'Британская территория в Индийском океане',
        'VG' => 'Британские Виргинские острова',
        'BN' => 'Бруней',
        'BF' => 'Буркина-Фасо',
        'BI' => 'Бурунди',
        'BT' => 'Бутан',
        'VU' => 'Вануату',
        'VA' => 'Ватикан',
        'UK' => 'Великобритания',
        'HU' => 'Венгрия',
        'VE' => 'Венесуэла',
        'UM' => 'Внешние малые острова, США',
        'TL' => 'Восточный Тимор (Тимор-Лешти)',
        'VN' => 'Вьетнам',
        'GA' => 'Габон',
        'HT' => 'Гаити',
        'GY' => 'Гайана',
        'GM' => 'Гамбия',
        'GH' => 'Гана',
        'GP' => 'Гваделупа',
        'GT' => 'Гватемала',
        'GF' => 'Гвиана',
        'GN' => 'Гвинея',
        'GW' => 'Гвинея-Бисау',
        'DE' => 'Германия',
        'GG' => 'Гернси',
        'GI' => 'Гибралтар',
        'HN' => 'Гондурас',
        'HK' => 'Гонконг',
        'GD' => 'Гренада',
        'GL' => 'Гренландия',
        'GR' => 'Греция',
        'GE' => 'Грузия',
        'GU' => 'Гуам',
        'DK' => 'Дания',
        'JE' => 'Джерси',
        'DJ' => 'Джибути',
        'DM' => 'Доминика',
        'DO' => 'Доминиканская Республика',
        'CD' => 'ДР Конго',
        'EG' => 'Египет',
        'EU' => 'Европа (Неизвестные страны)',
        'ZM' => 'Замбия',
        'EH' => 'Западная Сахара (САДР)',
        'ZW' => 'Зимбабве',
        'IL' => 'Израиль',
        'IN' => 'Индия',
        'ID' => 'Индонезия',
        'JO' => 'Иордания',
        'IQ' => 'Ирак',
        'IR' => 'Иран',
        'IE' => 'андии Ирландия',
        'IS' => 'Исландия',
        'ES' => 'Испания',
        'IT' => 'Италия',
        'YE' => 'Йемен',
        'CV' => 'Кабо-Верде',
        'KZ' => 'Казахстан',
        'KY' => 'Острова Кайман',
        'KH' => 'Камбоджа',
        'CM' => 'Камерун',
        'CA' => 'Канада',
        'QA' => 'Катар',
        'KE' => 'Кения',
        'CY' => 'Кипр',
        'KG' => 'Киргизия',
        'KI' => 'Кирибати',
        'TW' => 'Тайвань, КНР',
        'KP' => 'КНДР (Северная Корея)',
        'CN' => 'Китай (КНР)',
        'CC' => 'Кокосовые острова',
        'CO' => 'Колумбия',
        'KM' => 'Коморы',
        'CR' => 'Коста-Рика',
        'CI' => 'Кот-дИвуар',
        'CU' => 'Куба',
        'KW' => 'Кувейт',
        'CW' => 'Кюрасао',
        'LA' => 'Лаос',
        'LV' => 'Латвия',
        'LS' => 'Лесото',
        'LR' => 'Либерия',
        'LB' => 'Ливан',
        'LY' => 'Ливия',
        'LT' => 'Литва',
        'LI' => 'Лихтенштейн',
        'LU' => 'Люксембург',
        'MU' => 'Маврикий',
        'MR' => 'Мавритания',
        'MG' => 'Мадагаскар',
        'YT' => 'Майотта',
        'MO' => 'Макао',
        'MK' => 'Македония',
        'MW' => 'Малави',
        'MY' => 'Малайзия',
        'ML' => 'Мали',
        'MV' => 'Мальдивы',
        'MT' => 'Мальта',
        'MA' => 'Марокко',
        'MQ' => 'Мартиника',
        'MH' => 'Маршалловы Острова',
        'MX' => 'Мексика',
        'FM' => 'Микронезия',
        'MZ' => 'Мозамбик',
        'MD' => 'Молдавия',
        'MC' => 'Монако',
        'MN' => 'Монголия',
        'MS' => 'Монтсеррат',
        'MM' => 'Мьянма',
        'NA' => 'Намибия',
        'NR' => 'Науру',
        'NP' => 'Непал',
        'NE' => 'Нигер',
        'NG' => 'Нигерия',
        'NL' => 'Нидерланды',
        'NI' => 'Никарагуа',
        'NU' => 'Ниуэ',
        'NZ' => 'Новая Зеландия',
        'NC' => 'Новая Каледония',
        'NO' => 'Норвегия',
        'AE' => 'ОАЭ',
        'OM' => 'Оман',
        'BV' => 'Остров Буве',
        'IM' => 'Остров Мэн',
        'CK' => 'Острова Кука',
        'NF' => 'Остров Норфолк',
        'CX' => 'Остров Рождества',
        'PN' => 'Острова Питкэрн',
        'SH' => 'Острова Святой Елены, Вознесения и Тристан-да-Кунья',
        'PK' => 'Пакистан',
        'PW' => 'Палау',
        'PS' => 'Государство Палестина',
        'PA' => 'Панама',
        'PG' => 'Папуа — Новая Гвинея',
        'PY' => 'Парагвай',
        'PE' => 'Перу',
        'PL' => 'Польша',
        'PT' => 'Португалия',
        'PR' => 'Пуэрто-Рико',
        'CG' => 'Республика Конго',
        'KR' => 'Республика Корея (Южная Корея)',
        'RE' => 'Реюньон',
        'RU' => 'Россия',
        'RW' => 'Руанда',
        'RO' => 'Румыния',
        'SV' => 'Сальвадор',
        'WS' => 'Самоа',
        'SM' => 'Сан-Марино',
        'ST' => 'Сан-Томе и Принсипи',
        'SA' => 'Саудовская Аравия',
        'SZ' => 'Свазиленд',
        'MP' => 'Северные Марианские острова',
        'SC' => 'Сейшельские Острова',
        'BL' => 'Сен-Бартелеми',
        'MF' => 'Сен-Мартен',
        'PM' => 'Сен-Пьер и Микелон',
        'SN' => 'Сенегал',
        'VC' => 'Сент-Винсент и Гренадины',
        'KN' => 'Сент-Китс и Невис',
        'LC' => 'Сент-Люсия',
        'RS' => 'Сербия',
        'SG' => 'Сингапур',
        'SY' => 'Сирийская Арабская Республика (Сирия)',
        'SK' => 'Словакия',
        'SI' => 'Словения',
        'SB' => 'Соломоновы Острова',
        'SO' => 'Сомали',
        'SD' => 'Судан',
        'SR' => 'Суринам',
        'US' => 'США',
        'SL' => 'Сьерра-Леоне',
        'TJ' => 'Таджикистан',
        'TH' => 'Таиланд',
        'TZ' => 'Танзания',
        'TC' => 'Тёркс и Кайкос',
        'TG' => 'Того',
        'TK' => 'Токелау',
        'TO' => 'Тонга',
        'TT' => 'Тринидад и Тобаго',
        'TV' => 'Тувалу',
        'TN' => 'Тунис',
        'TM' => 'Туркмения',
        'TR' => 'Турция',
        'UG' => 'Уганда',
        'UZ' => 'Узбекистан',
        'UA' => 'Украина',
        'WF' => 'Уоллис и Футуна',
        'UY' => 'Уругвай',
        'FO' => 'Фареры',
        'FJ' => 'Фиджи',
        'PH' => 'Филиппины',
        'FI' => 'Финляндия',
        'FK' => 'Фолклендские (Мальвинские) острова',
        'FR' => 'Франция',
        'PF' => 'Французская Полинезия',
        'TF' => 'Французские Южные и Антарктические Территории',
        'HM' => 'Остров Херд и острова Макдональд',
        'HR' => 'Хорватия',
        'CF' => 'ЦАР',
        'TD' => 'Чад',
        'ME' => 'Черногория',
        'CZ' => 'Чехия',
        'CL' => 'Чили',
        'CH' => 'Швейцария',
        'SE' => 'Швеция',
        'SJ' => 'Шпицберген и Ян-Майен',
        'LK' => 'Шри-Ланка',
        'EC' => 'Эквадор',
        'GQ' => 'Экваториальная Гвинея',
        'ER' => 'Эритрея',
        'EE' => 'Эстония',
        'ET' => 'Эфиопия',
        'ZA' => 'ЮАР',
        'GS' => 'Южная Георгия и Южные Сандвичевы острова',
        'JM' => 'Ямайка',
        'JP' => 'Япония',
    );

    /**
     * @param string $code
     *
     * @return string
     */
    public static function countryNameByCode($code) {

        return (!empty(self::$countries[$code])) ? self::$countries[$code] : '';
    }

    /**
     * @param int   $n
     * @param array $forms
     *
     * @return string
     */
    public static function pluralForm($n, $forms) {

        return ($n % 10 == 1 && $n % 100 != 11) ? $forms[0] : ($n % 10 >= 2 && $n % 10 <= 4 && ($n % 100 < 10 || $n % 100 >= 20) ? $forms[1] : $forms[2]);
    }

    public static function getCountryByIp($ip) {

        $geoipDataBase = realpath(__DIR__ . '/../../Resources/GeoIP/GeoIP2-City.mmdb');

        if (file_exists($geoipDataBase)) {
            try {

                $reader = new Reader($geoipDataBase);
                $record = $reader->city($ip);

                if (empty($record) || empty($record->country) || empty($record->country->isoCode)) {
                    throw new AddressNotFoundException;
                }

                return $record->country->isoCode;

            } catch (AddressNotFoundException $e) {

                return 'RU';
            }
        }

        return 'RU';
    }
}